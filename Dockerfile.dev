FROM rust:latest

RUN apt-get update && apt-get install -y \
    wget \
    curl

RUN wget https://dist.ipfs.tech/kubo/v0.38.2/kubo_v0.38.2_linux-amd64.tar.gz
RUN tar -xvzf kubo_v0.38.2_linux-amd64.tar.gz
RUN cd kubo && bash install.sh
RUN ipfs init

RUN cargo install cargo-watch

WORKDIR /app

COPY . .

RUN cargo build --release

EXPOSE 8000
EXPOSE 5001
EXPOSE 4001

CMD ["sh", "start.sh"]
